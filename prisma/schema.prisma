// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["typedSql"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum Region {
    PAL
    NTSC
    NTSCJ
}

enum Console {
    PS1
    PS2
    PSP
}

enum Status {
    ADMIN
    MOD
    USER
}

/**
 * - CREATE INDEX idx_library_user_game ON "Library" ("userId", "gameId");
 * - CREATE INDEX idx_game_parent ON "Game" (parent_id);
 */

model Game {
    id String @id

    title String

    console Console
    region  Region

    Library Library[]

    parent_id String?
    parent    Game?   @relation("ParentSubgame", references: [id], fields: [parent_id])
    subgames  Game[]  @relation("ParentSubgame")

    @@index([parent_id])
}

model Library {
    conn_id Int    @id @default(autoincrement())
    user_id User   @relation(fields: [userId], references: [id])
    game_id Game   @relation(fields: [gameId], references: [id])
    userId  String
    gameId  String

    @@index([userId, gameId])
}

model Session {
    id     Int      @id @default(autoincrement())
    date   DateTime @default(now())
    maxAge Int      @default(2592000) // a month

    user   User   @relation(fields: [userId], references: [id])
    userId String

    token String @unique

    @@index([token])
}

model User {
    id        String   @id @default(uuid())
    nick      String   @unique
    email     String   @unique
    createdAt DateTime @default(now())
    password  String

    status Status @default(USER)

    salt    String
    Session Session[]

    Library Library[]
}
